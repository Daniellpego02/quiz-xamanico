# Anti-Plagiarism Protection - Nginx Configuration
# Add this to your nginx server block

# Block bad bots and scrapers
map $http_user_agent $bad_bot {
    default 0;
    ~*HTTrack 1;
    ~*WebCopier 1;
    ~*WebZIP 1;
    ~*wget 1;
    ~*curl 1;
    ~*libwww-perl 1;
    ~*python-requests 1;
    ~*scrapy 1;
    ~*AhrefsBot 1;
    ~*SemrushBot 1;
    ~*MJ12bot 1;
    ~*DotBot 1;
    ~*BLEXBot 1;
    ~*DataForSeoBot 1;
    ~*SiteSucker 1;
    ~*WebReaper 1;
    ~*Teleport 1;
    ~*WebStripper 1;
    ~*Offline\ Explorer 1;
    ~*BlackWidow 1;
}

server {
    listen 80;
    listen [::]:80;
    server_name mapaxamanicooficial.online www.mapaxamanicooficial.online;
    
    # Redirect HTTP to HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name mapaxamanicooficial.online www.mapaxamanicooficial.online;

    # SSL certificates (update paths as needed)
    # ssl_certificate /path/to/fullchain.pem;
    # ssl_certificate_key /path/to/privkey.pem;

    root /var/www/html;
    index index.html;

    # Block bad bots
    if ($bad_bot) {
        return 403;
    }

    # Disable directory listing
    autoindex off;

    # Block access to sensitive files
    location ~ /\.(env|git|htaccess) {
        deny all;
        return 404;
    }

    location ~ \.(log|sql|md|txt|json)$ {
        deny all;
        return 404;
    }

    # Prevent hotlinking of images
    location ~* \.(jpg|jpeg|png|gif|webp|svg)$ {
        valid_referers none blocked mapaxamanicooficial.online www.mapaxamanicooficial.online;
        if ($invalid_referer) {
            return 403;
        }
        expires 30d;
        add_header Cache-Control "public, immutable";
    }

    # Security headers
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    add_header Content-Security-Policy "frame-ancestors 'self'" always;

    # Hide nginx version
    server_tokens off;

    # Main location
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Specific routes
    location /obrigado {
        try_files /obrigado.html =404;
    }

    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/javascript;
    gzip_comp_level 6;
}
